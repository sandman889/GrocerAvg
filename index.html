<!DOCTYPE html>
<head>
  <title> Customer Averages </title>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="d3.parcoords.js" type="text/javascript"> </script>
  <link rel=stylesheet type="text/css" href="d3.parcoord.css">
  <meta charset="UTF-8">
</head>
<body>
	<div id="parcoords"> </div>
  	<script>
  		//create color scale
  		var colorScale = d3.scale.linear()
  			.domain([9, 50])
  			.range(["green, black"])
  			.interpolate(d3.interpolateLab);

		var parc = null;
  		var data = null;

  		d3.json("grocerData.json", function(error, json) {
  			if (error) { console.warn("error loading json"); }
			else {
  				data = json;
  				parc = d3.parcoords()("#parcoords")
  					.data(data)
  					.hideAxis(["name"])
  					.composite("darker")
  					.color(function (d) { return colorScale(d['Income']); })
  					.alpha(0.35)
  					.render()
  					.brushMode("1d-axes")
  					.interactive()

  				var exploreCount = 0;
  				var exploring = {};
  				var exploreStart = false;

  				parc.svg
  					.selectAll(".dimension")
  					.style("cursor", "pointer")
  					.on("click", function(d) {
  						exploring[d] = d in exploring ? false : true;
  						event.preventDefault();
  						if(exploring[d]) d3.timer(explore(d, exploreCount));
  					});

  				function explore(dimension, count) {
  					if(!exploreStart) {
  						exploreStart = true;
  						d3.timer(parc.brush);
  					}

  					var speed = (Math.round(Math.random()) ? 1 : -1) * (Math.random()+0.5);

  					return function(t) {
  						if(!exploring[dimension]) return true;
  						var domain = parc.yscale[dimension].domain();
  						var width = (domain[1] - domain[0])/4;
  						var center = width*1.5*(1+Math.sin(speed*t/1200)) + domain[0];

  						parc.yscale[dimension].brush.extent([
  							d3.max([center-width*0.01, domain[0]-width/400]),
  							d3.min([center+width*1.01, domain[1]+width/100])
  						])(pc1.g()
  							.filter(function(d) {
  								return d == dimension;
  							})
  						);
  					};
  				};
			};
  		});

  </script>
</body>

</html>
